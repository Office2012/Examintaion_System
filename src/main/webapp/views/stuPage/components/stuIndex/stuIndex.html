<link rel="stylesheet" href="components/template/file/fileCommon.css" />

<style>
	/** 卡片轮播图样式 */
	.admin-carousel .layui-carousel-ind {
		position: absolute;
		top: -41px;
		text-align: right;
	}

	.admin-carousel .layui-carousel-ind ul {
		background: 0 0;
	}

	.admin-carousel .layui-carousel-ind li {
		background-color: #e2e2e2;
	}

	.admin-carousel .layui-carousel-ind li.layui-this {
		background-color: #999;
	}

	/** 广告位轮播图 */
	.admin-news .layui-carousel-ind {
		height: 45px;
	}

	.admin-news a {
		display: block;
		line-height: 60px;
		text-align: center;
	}

	/** 复写日历*/

	.layui-laydate {
		background-color: rgba(0, 0, 0, 0);
		box-shadow: 0 0 0 rgba(0, 0, 0, 0);
		border: 0px solid #d2d2d2;
	}

	.layui-laydate-main {
		width: auto;
	}

	#noticClick,
	#downloadDoc,
	#moreFiles {
		cursor: pointer;
	}

	#noticClick:hover {
		background-color: #F2F2F2;
	}

	#docFont a:hover {
		color: #009688;
	}

	#moreFiles:hover {
		color: #009688;
	}
	
</style>
<style>
	.user-info-head {
		width: 110px;
		height: 110px;
		position: relative;
		display: inline-block;
		border-radius: 50%;
		border: 2px solid #eee;
	}

	.user-info-head:hover:after {
		content: '\e65d';
		position: absolute;
		left: 0;
		right: 0;
		top: 0;
		bottom: 0;
		color: #eee;
		background: rgba(0, 0, 0, 0.5);
		font-family: layui-icon;
		font-size: 24px;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		cursor: pointer;
		line-height: 110px;
		border-radius: 50%;
	}

	.user-info-head img {
		width: 110px;
		height: 110px;
		border-radius: 50%;
	}

	.info-list-item {
		position: relative;
		padding-bottom: 8px;
	}

	.info-list-item>.layui-icon {
		position: absolute;
	}

	.info-list-item>p {
		padding-left: 30px;
	}

	.dash {
		border-bottom: 1px dashed #ccc;
		margin: 15px 0;
	}

	.layui-badge-list .layui-badge {
		margin-right: 6px;
	}

	.layui-badge-list .layui-badge {
		padding: 2px 7px;
		border: 1px solid #ccc;
		margin-bottom: 8px;
		background-color: #fafafa !important;
	}

	.bd-list-item {
		padding: 14px 0;
		border-bottom: 1px solid #e8e8e8;
		position: relative;
	}

	.bd-list-item .bd-list-item-img {
		width: 48px;
		height: 48px;
		line-height: 48px;
		margin-right: 12px;
		display: inline-block;
		vertical-align: middle;
	}

	.bd-list-item .bd-list-item-content {
		display: inline-block;
		vertical-align: middle;
	}

	.bd-list-item .bd-list-item-lable {
		margin-bottom: 4px;
		color: #333;
	}

	.bd-list-item .bd-list-item-oper {
		position: absolute;
		right: 0;
		top: 50%;
		text-decoration: none !important;
		cursor: pointer;
		transform: translateY(-50%);
	}

	.user-info-form .layui-form-item {
		margin-bottom: 25px;
	}
</style>
<div class="layui-fluid">
	<div class="layui-row layui-col-space15">
		<div class="layui-col-lg2 layui-col-md2">
			<div class="layui-card">
				<div class="layui-card-header">
					<span class="layui-badge layui-bg-blue">我的名片</span>
				</div>
				<div class="layui-card-body">
					<!-- 左 -->
					<div class="text-center layui-text">
						<div class="user-info-head" id="imgHead">
							<img src="assets/images/head.png" />
						</div>
						<h2 style="padding-top: 20px;">夏亦林</h2>
					</div>
					<div class="dash"></div>
					<div class="layui-text">
						<div class="info-list-item">
							<i class="layui-icon layui-icon-username"></i>
							<p>学生</p>
						</div>
						<div class="info-list-item" style="">
							<i class="layui-icon layui-icon-release"></i>
							<p>计算机学院</p>
						</div>
					</div>
				</div>
			</div>
			<div class="layui-card">
				<div class="layui-card-header">
					<span class="layui-badge layui-bg-green">校历</span>
				</div>
				<div class="layui-card-body">
					 <!-- <div id="calendarDiv" class="calendarDiv"></div> -->
					<li>
						<div class="calendar">
							<div class="title">
								<a class="green" id="calendar-year">年</a>
								<a class="green" id="calendar-title">月</a>
								<a href="" ><img src="assets/images/prev.png" id="pre"  alt=""></img></a>
								<a href="" ><img src="assets/images/next.png" id="next" alt=""></img></a>
								<a href="" ><img src="assets/images/prev_year.png" id="pre_year"  alt=""></img></a>
								<a href="" ><img src="assets/images/next_year.png" id="next_year" alt=""></img></a>
							</div>
							<div class="body">
								<div class="lightgrey body-list-title">
									<ul>
										<li>日</li>
										<li>一</li>
										<li>二</li>
										<li>三</li>
										<li>四</li>
										<li>五</li>
										<li>六</li>
									</ul>
								</div>
								<div class="darkgrey body-list">
									<ul id="days">
									</ul>
								</div>
							</div>
						</div>
					</li>
				</div>
			</div>
			<div class="layui-card">
				<div class="layui-card-header">
					<span class="layui-badge layui-bg-black">文档下载</span>
					<a id="moreFiles"><span class="pull-right">
							<font style="font-size: 12px;">更多></font>
						</span></a>
				</div>
				<div class="layui-card-body layui-row">
					<div id="downloadDoc">
						<!-- 文档下载 -->

					</div>
				</div>
			</div>
			<div class="layui-card">
				<div class="layui-card-header">
					<span class="layui-badge layui-bg-orange">联系我们</span>
				</div>
				<div class="layui-card-body">
					<div class="text-center layui-text">
						<div>
							<img src="assets/images/QRCode.png" style="width: 60%;height: 60%;" />
						</div>

					</div>
				</div>
			</div>
		</div>
		<div class="layui-col-lg8 layui-col-md8">
			<div class="layui-card">
				<div class="layui-card-header">通知公告</div>
				<div class="layui-card-body">
					<ul class="layui-timeline" id="NoticDiv">
						<!-- 公告  -->
					</ul>
				</div>
			</div>
		</div>
		<div class="layui-col-lg2 layui-col-md2">
			<div class="layui-card">
				<div class="layui-card-header">今日课程</div>
				<div class="layui-card-body">
					<table class="layui-table layui-text">
						<colgroup>
							<col width="100">
							<col>
						</colgroup>

					</table>
				</div>
			</div>

			<div class="layui-card">
				<div class="layui-card-header">我的消息</div>
				<div class="layui-card-body">
					<table class="layui-table layui-text">
						<colgroup>
							<col width="100">
							<col>
						</colgroup>

					</table>
				</div>
			</div>
			<div class="layui-card">
				<div class="layui-card-header">快捷访问</div>
				<div class="layui-card-body">
					<div class="layui-carousel admin-carousel admin-news">
						<div carousel-item>
							<div>
								<a href="javascript:void(0)" target="_blank" class="layui-bg-green">
									校园网
								</a>
							</div>
							<div>
								<a href="javascript:void(0)" target="_blank" class="layui-bg-cyan">
									官网资源快讯
								</a>
							</div>
							<div>
								<a href="javascript:void(0)" target="_blank" class="layui-bg-blue">
									后院娱乐社区
								</a>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- 渲染模板 -->
<script id="fileList" type="text/html">
	{{#  layui.each(d, function(index, item){ }}
	{{# var fid = item.fileId }} 
    <div class="file-list-item"  data-name="{{item.fileName}}" onclick="DownloadOnClick({{ item.fileId }})">
			{{# var suffix = item.fileName.substring(item.fileName.lastIndexOf(".")+1) }} 
            <img src="components/template/file/fti/{{ suffix }}.png"/>
        <div class="file-list-name">{{item.fileName}}</div>
    </div>
    {{#  }); }}
    {{# if(d.length<=0){ }}
    <div class="list-empty">
        <i class="layui-icon layui-icon-face-surprised"></i>
        <div>没有文件</div>
    </div>
    {{# } }}
</script>
<script>
	layui.use(['layer', 'carousel', 'laydate'], function() {
		var $ = layui.jquery;
		var layer = layui.layer;
		var carousel = layui.carousel;
		var device = layui.device;
		var laydate = layui.laydate;
		// 轮播
		carousel.render({
			elem: '.layui-carousel',
			width: '100%',
			height: '60px',
			arrow: 'none',
			autoplay: true,
			trigger: device.ios || device.android ? 'click' : 'hover',
			anim: 'fade'
		});
		laydate.render({
			elem: '#calendarDiv',
			position: 'static',
			showBottom: false,
			theme: 'default',
			calendar: true
		});
	});
</script>
<!-- 流加载公告 -->
<script>
	layui.use('flow', function() {
		var $ = layui.jquery; //不用额外加载jQuery，flow模块本身是有依赖jQuery的，直接用即可。
		var flow = layui.flow;
		var pageNum = 5;

		flow.load({
			elem: '#NoticDiv',
			isAuto: false,
			isLazyimg: true,
			done: function(page, next) { //加载下一页//模拟插入
				setTimeout(function() {
					var lis = [];
					$.get('./json/noticTest.json', function(res) { //$.get('/api/list?page=' + page, function(res) {}
						layui.each(res.data, function(index, item) {
							var contentEleme = item.noticContent.substring(0, 100) + "...";
							var htmlElem =
								'<li class="layui-timeline-item" id="noticClick" onclick="noticOnClick(' + item.noticId +
								');" num="' + item.noticId + '"><i class="layui-icon layui-timeline-axis">&#xe63f;</i>' +
								'<div class="layui-timeline-content layui-text">' +
								'<h3 class="layui-timeline-title"><small id="noticTitle' + item.noticId + '">' + item.noticTitle +
								'</small></h3>' +
								'<ul><li id="noticContent' + item.noticId + '" style="display:none">' + item.noticContent +
								'</li><li>' + contentEleme + '</li></ul>' +
								'<span class="layui-badge-rim pull-right" id="noticTime' + item.noticId + '">' + item.noticTime +
								'</span>' +
								'<span class="layui-badge-rim pull-right" id="noticPublisher' + item.noticId + '">' + item.noticPublisher +
								'</span></div></li>';
							lis.push(htmlElem);
							// var tagRegx = "/</?[a-zA-Z]+[^><]*>";
							// var blankRegx = "/(^\\s*)|(\\s*$)";
							// alert(htmlElem.replace(/<\/?.+?>/g,""));
							htmlElem = '';
						});
						next(lis.join(''), page < pageNum); //总页数 pageNum
					});
				}, 500);
			}
		});

	});
	//公告弹窗
	function noticOnClick(num) {
		layui.use('admin', function() {
			var $ = layui.jquery;
			var admin = layui.admin;
			var noticTitle = $('#noticTitle' + num).text();
			var noticContent = $('#noticContent' + num).html();
			var noticTime = $('#noticTime' + num).text();
			var noticPublisher = $('#noticPublisher' + num).text();
			var htmlEleme =
				'<div class="layui-row"><p class="text-center" style="font-size: 20px;margin-top: 20px;">《' + noticTitle +
				'》</p></div>' +
				'<div class="layui-row"><p class="text-left" style="margin-left: 60px;margin-right: 60px;margin-top: 40px;font-size:16px">&emsp;&emsp;' +
				noticContent + '</p></div>' +
				'<br/><br/><br/><div class="layui-row text-right" style="margin-right:60px;font-size:15px"><p>' + noticPublisher +
				'</p><p>' + noticTime + '</p></div>';
			//$(this).parents("tr").find("td:eq(2)").text();
			//$(document).on("click", "#moreFiles", function () {
			// $('#noticClick').click(function() {
			admin.open({
				type: 1,
				title: noticTitle,
				shade: 0,
				maxmin: true,
				resize: false,
				area: ['70%', '85%'],
				content: htmlEleme,
				shade: [0.8, '#393D49'],
				shadeClose: true,

			});


		});
	}
	<!-- 文档下载 -->
	layui.use('flow', function() {
		var $ = layui.jquery; //不用额外加载jQuery，flow模块本身是有依赖jQuery的，直接用即可。
		var flow = layui.flow;
		var pageNum = 8;
		var lis = [];
		var htmlElem = "";
		$.get('/selectPartFile', function(res) { //$.get('/api/list?page=' + page, function(res) {}./json/downloadTest.json

			layui.each(res.data, function(index, item) {
				if (index < pageNum) {
					var fid = item.fileId;
					var fname = item.fileName;
					var htmlElem =
						'<div class="layui-row"><div class="layui-col-lg1 layui-col-md1"><i class="layui-icon" style="font-size: 18px;font-weight: 600;color: #7B7B7B;">&#xe621;</i></div>' +
						'<div class="layui-col-lg10 layui-col-md10" id="docFont">' +
						'<p style="width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#7B7B7B">' +
						'<a title="' + fname + '">' + fname +
						'</a></p></div><div class="layui-col-lg1 layui-col-md1" id="docIcon" onclick="DownloadOnClick(' + fid +
						');" >' +
						'<a class="pull-right layui-icon" style="font-size: 18px; font-weight: 600;color: #1E9FFF;" title="下载">&#xe601</a></div></div>';
					lis.push(htmlElem);
				}
			});
			$('#downloadDoc').append(lis);
			lis = [];
		});
	});
	//下载
	function DownloadOnClick(num) {
		layui.use('admin', function() {
			var $ = layui.jquery;
			var admin = layui.admin;
			// var url = '/downloadFile?fildId=' + num;
			// $.get(url, {
			// 	property: 0,
			// }, function(res) {
			// 	if (res.code == 200)
			// 		alert("文件开始下载！");
			// 	else
			// 		alert('下载出错！原因：' + res.msg)
			// });
			window.location.href='/downloadFile?fileId=' + num;
		});
	}
	//更多
	layui.use(['admin', 'laytpl'], function() {
		var $ = layui.jquery;
		var admin = layui.admin;
		var laytpl = layui.laytpl;
		var htmlEleme = '<div class="fileListDiv" id="fileListDiv"><span>文件列表</span></div>';
		var htmlElem =
			'<div class="layui-fluid"><div class="layui-card"><div class="layui-card-header">全部文档</div><div class="layui-card-body">' +
			'<div class="fileListDiv" id="fileListDiv"></div></div></div>';
		$('#moreFiles').click(function() {
			admin.open({
				type: 1,
				title: '选择文件',
				content: htmlElem,
				area: ['1150px', '700px'],
				fixed: false,
				resize: false,
				shade: .5,
				shadeClose: true,
			});
			//渲染更多
			layui.use(['jquery', 'layer', 'laytpl'], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var laytpl = layui.laytpl;
				// 渲染文件列表
				$.get('/selectAllFile', {}, function(res) { //./json/moreFileTest.json
					layer.closeAll('loading');
					if (res.code == 200) {
						var fileListHtml = fileList.innerHTML;
						fileListView = document.getElementById('fileListDiv');
						laytpl(fileListHtml).render(res.data, function(html) {
							fileListView.innerHTML = html;
						});
					} else {
						layer.msg(res.msg, {
							icon: 2
						});
					}
				});

			});
		});

	});
</script>
<!-- js部分 -->
<script>
	layui.use(['layer', 'form', 'admin'], function() {
		var $ = layui.jquery;
		var layer = layui.layer;
		var form = layui.form;
		var admin = layui.admin;

		// 选择头像
		$('#imgHead').click(function() {
			admin.cropImg({
				onCrop: function(res) {
					$('#imgHead>img').attr('src', res);
				}
			});
		});

	});
	//日历
	var month_olypic = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
	var month_normal = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
	var month_name = ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"];
	var holder = document.getElementById("days");
	var prev = document.getElementById("prev");
	var next = document.getElementById("next");
	var ctitle = document.getElementById("calendar-title");
	var cyear = document.getElementById("calendar-year");
	var my_date = new Date();
	var my_year = my_date.getFullYear(); 
	var my_month = my_date.getMonth(); 
	var my_day = my_date.getDate();
	function dayStart(month, year) {
		var tmpDate = new Date(year, month, 1);
		return (tmpDate.getDay());
	}
	function daysMonth(month, year) {
		var tmp1 = year % 4;
		var tmp2 = year % 100;
		var tmp3 = year % 400;
		if ((tmp1 == 0 && tmp2 != 0) || (tmp3 == 0)) {
			return (month_olypic[month]); //闰年
		} else {
			return (month_normal[month]); //非闰年
		}
	}
	//js实现str插入li+class,不要忘了用innerhtml进行插入
	function refreshDate() {
		var str = "";
		var totalDay = daysMonth(my_month, my_year);
		var firstDay = dayStart(my_month, my_year);
		for (var i = 0; i < firstDay; i++) {
			str += "<li>" + "</li>";
		}
		var myclass;
		for (var i = 1; i <= totalDay; i++) {
			console.log(my_year + " " + my_month + " " + my_day);
			console.log(my_date.getFullYear() + " " + my_date.getMonth() + " " + my_date.getDay());
			if ((my_year < my_date.getFullYear()) || (my_year == my_date.getFullYear() && my_month < my_date.getMonth()) || (
					my_year == my_date.getFullYear() && my_month == my_date.getMonth() && i < my_day)) {
				myclass = " class='lightgrey'";
			} else if (my_year == my_date.getFullYear() && my_month == my_date.getMonth() && i == my_day) {
				myclass = "class = 'green greenbox'";
			} else {
				myclass = "class = 'darkgrey'";
			}
			str += "<li " + myclass + ">" + i + "</li>";
		}
		holder.innerHTML = str;
		ctitle.innerHTML = month_name[my_month];
		cyear.innerHTML = my_year+'年';
	}
	//调用refreshDate()函数，日历才会出现
	refreshDate();
	//实现onclick向前或向后移动
	pre_year.onclick = function(e) {
		e.preventDefault();
		my_year--;
		refreshDate();
	}
	next_year.onclick = function(e) {
		e.preventDefault();
		my_year++;
		refreshDate();
	}
	pre.onclick = function(e) {
		e.preventDefault();
		my_month--;
		if (my_month < 0) {
			my_year--;
			my_month = 11; //即12月份
		}
		refreshDate();
	}
	next.onclick = function(e) {
		e.preventDefault();
		my_month++;
		if (my_month > 11) {
			my_month = 0;
			my_year++;
		}
		refreshDate();
	}
</script>
